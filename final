<!DOCTYPE html>
<html lang="hi" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gram Sahayak AI - рдЧреНрд░рд╛рдо рд╕рд╣рд╛рдпрдХ AI</title>
<link href="https://fonts.googleapis.com/css2?family=Tiro+Devanagari+Hindi:ital@0;1&family=Baloo+2:wght@400;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#f5f0e8;--bg2:#ece6d8;--bg3:#fff9ef;--card:#fffdf7;--border:#c8b99a;--text:#2c1f0e;--text2:#5c4a2e;--text3:#8a7055;--accent:#2d7a3a;--accent2:#e07b1a;--accent3:#c0392b;--green:#27ae60;--yellow:#f39c12;--leaf:#4a8c2a;--mud:#8b5e3c;--sky:#2980b9;--shadow:rgba(44,31,14,0.12);--input-bg:#fffef9}
[data-theme="dark"]{--bg:#0f1a0d;--bg2:#152212;--bg3:#1a2e18;--card:#1f3a1c;--border:#2e5c2a;--text:#e8f5e3;--text2:#a8d4a0;--text3:#6fa867;--accent:#4caf50;--accent2:#ff9800;--accent3:#ef5350;--green:#66bb6a;--yellow:#ffa726;--leaf:#7cb342;--mud:#a1714e;--sky:#42a5f5;--shadow:rgba(0,0,0,0.4);--input-bg:#162914}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Baloo 2',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;transition:background .3s,color .3s;overflow-x:hidden}
.header{background:linear-gradient(135deg,var(--accent) 0%,var(--leaf) 60%,var(--accent2) 100%);position:sticky;top:0;z-index:100;box-shadow:0 4px 20px var(--shadow)}
.header-inner{display:flex;align-items:center;justify-content:space-between;padding:12px 20px;max-width:900px;margin:0 auto}
.logo-area{display:flex;align-items:center;gap:12px}
.logo-icon{width:48px;height:48px;background:rgba(255,255,255,.2);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:26px;border:2px solid rgba(255,255,255,.4)}
.logo-text h1{font-size:1.2rem;font-weight:800;color:#fff;line-height:1.1}
.logo-text p{font-size:.68rem;color:rgba(255,255,255,.85);font-family:'Space Mono',monospace}
.header-controls{display:flex;align-items:center;gap:10px}
.btn-icon{background:rgba(255,255,255,.2);border:1px solid rgba(255,255,255,.35);color:#fff;width:38px;height:38px;border-radius:10px;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:background .2s}
.btn-icon:hover{background:rgba(255,255,255,.35)}
.lang-toggle{background:rgba(255,255,255,.2);border:1px solid rgba(255,255,255,.35);color:#fff;padding:6px 14px;border-radius:20px;cursor:pointer;font-family:'Baloo 2',sans-serif;font-size:.8rem;font-weight:700;transition:background .2s}
.lang-toggle:hover{background:rgba(255,255,255,.35)}
.ai-badge{background:rgba(255,255,255,.25);border:1px solid rgba(255,255,255,.5);color:#fff;padding:4px 10px;border-radius:20px;font-size:.7rem;font-weight:700;font-family:'Space Mono',monospace;display:flex;align-items:center;gap:5px}
.ai-dot{width:6px;height:6px;border-radius:50%;background:#7fff7f;animation:pulse 1.5s infinite}
.status-bar{background:var(--bg2);padding:6px 20px;display:flex;align-items:center;gap:16px;border-bottom:1px solid var(--border);font-size:.72rem;color:var(--text3);font-family:'Space Mono',monospace;overflow-x:auto}
.status-item{display:flex;align-items:center;gap:5px;white-space:nowrap}
.dot{width:7px;height:7px;border-radius:50%}
.dot-green{background:#27ae60;animation:pulse 2s infinite}
.dot-yellow{background:#f39c12}
.dot-red{background:#c0392b}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
.tabs{display:flex;background:var(--bg2);border-bottom:2px solid var(--border);overflow-x:auto;max-width:900px;margin:0 auto}
.tab{padding:10px 16px;cursor:pointer;font-size:.82rem;font-weight:600;color:var(--text3);border-bottom:3px solid transparent;white-space:nowrap;transition:all .2s;display:flex;align-items:center;gap:6px}
.tab.active{color:var(--accent);border-bottom-color:var(--accent);background:var(--bg3)}
.tab:hover{color:var(--accent2)}
.main{max-width:900px;margin:0 auto;padding:16px}
.tab-content{display:none}
.tab-content.active{display:block}
.chat-container{display:flex;flex-direction:column;height:calc(100vh - 210px);min-height:400px}
.chat-messages{flex:1;overflow-y:auto;padding:12px 0;display:flex;flex-direction:column;gap:12px}
.msg{display:flex;gap:10px;align-items:flex-start;animation:fadeUp .3s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.msg.user{flex-direction:row-reverse}
.msg-avatar{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.msg.bot .msg-avatar{background:linear-gradient(135deg,var(--accent),var(--leaf))}
.msg.user .msg-avatar{background:linear-gradient(135deg,var(--accent2),var(--yellow))}
.msg-bubble{max-width:78%;padding:10px 14px;border-radius:14px;font-size:.88rem;line-height:1.55}
.msg.bot .msg-bubble{background:var(--card);border:1px solid var(--border);border-radius:4px 14px 14px 14px}
.msg.user .msg-bubble{background:linear-gradient(135deg,var(--accent),var(--leaf));color:#fff;border-radius:14px 4px 14px 14px}
.msg-time{font-size:.65rem;color:var(--text3);margin-top:4px;font-family:'Space Mono',monospace}
.msg-source{font-size:.62rem;color:var(--accent2);margin-top:2px;font-family:'Space Mono',monospace}
.quick-chips{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0}
.chip{padding:6px 12px;background:var(--bg2);border:1px solid var(--border);border-radius:20px;font-size:.78rem;cursor:pointer;color:var(--text2);transition:all .2s;font-family:'Baloo 2',sans-serif}
.chip:hover{background:var(--accent);color:#fff;border-color:var(--accent)}
.chat-input-area{padding-top:12px;border-top:1px solid var(--border)}
.chat-input-row{display:flex;gap:8px;align-items:flex-end}
.chat-input{flex:1;padding:10px 14px;background:var(--input-bg);border:1.5px solid var(--border);border-radius:14px;font-family:'Baloo 2',sans-serif;font-size:.9rem;color:var(--text);resize:none;outline:none;transition:border-color .2s}
.chat-input:focus{border-color:var(--accent)}
.send-btn{background:var(--accent);color:#fff;border:none;width:44px;height:44px;border-radius:12px;cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center;transition:background .2s}
.send-btn:hover{background:var(--leaf)}
.send-btn:disabled{background:var(--text3);cursor:not-allowed}
.data-usage{font-size:.68rem;color:var(--text3);text-align:center;margin-top:6px;font-family:'Space Mono',monospace}
.ai-mode-bar{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;padding:6px 10px;background:var(--bg2);border-radius:10px;border:1px solid var(--border);font-size:.74rem;color:var(--text3)}
.ai-toggle-row{display:flex;align-items:center;gap:8px}
.toggle-switch{position:relative;width:36px;height:20px;cursor:pointer}
.toggle-switch input{opacity:0;width:0;height:0}
.toggle-slider{position:absolute;inset:0;background:var(--border);border-radius:20px;transition:.3s}
.toggle-slider:before{content:'';position:absolute;width:14px;height:14px;left:3px;top:3px;background:#fff;border-radius:50%;transition:.3s}
input:checked+.toggle-slider{background:var(--accent)}
input:checked+.toggle-slider:before{transform:translateX(16px)}
.weather-card{background:linear-gradient(135deg,#1a6fa8,#2980b9,#3498db);border-radius:18px;padding:20px;color:#fff;margin-bottom:16px;position:relative;overflow:hidden}
.weather-card::before{content:'';position:absolute;top:-30px;right:-30px;width:120px;height:120px;background:rgba(255,255,255,.08);border-radius:50%}
.weather-main{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
.weather-temp{font-size:3rem;font-weight:800;line-height:1}
.weather-icon-big{font-size:3.5rem}
.weather-desc{font-size:.9rem;opacity:.9;margin-top:4px}
.weather-location{font-size:1.1rem;font-weight:700}
.weather-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;border-top:1px solid rgba(255,255,255,.2);padding-top:14px}
.weather-stat{text-align:center}
.weather-stat-val{font-size:1.1rem;font-weight:700}
.weather-stat-lbl{font-size:.68rem;opacity:.8}
.weather-advice{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:12px}
.weather-advice h3{color:var(--accent);margin-bottom:10px;font-size:.95rem}
.advice-item{display:flex;align-items:flex-start;gap:8px;padding:7px 0;border-bottom:1px dashed var(--border);font-size:.84rem;color:var(--text2)}
.advice-item:last-child{border-bottom:none}
.fetch-weather-btn{background:var(--sky);color:#fff;border:none;padding:10px 20px;border-radius:12px;cursor:pointer;font-family:'Baloo 2',sans-serif;font-size:.88rem;font-weight:600;width:100%;transition:opacity .2s;margin-bottom:16px}
.fetch-weather-btn:hover{opacity:.85}
.calendar-card{background:var(--card);border:1px solid var(--border);border-radius:18px;overflow:hidden;margin-bottom:16px}
.calendar-header-row{background:linear-gradient(135deg,var(--accent),var(--leaf));padding:16px 20px;display:flex;align-items:center;justify-content:space-between;color:#fff}
.cal-nav-btn{background:rgba(255,255,255,.2);border:none;color:#fff;width:32px;height:32px;border-radius:8px;cursor:pointer;font-size:16px;transition:background .2s}
.cal-nav-btn:hover{background:rgba(255,255,255,.35)}
.cal-month-title{font-size:1.1rem;font-weight:700;text-align:center}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:1px;background:var(--border)}
.cal-day-header{background:var(--bg2);text-align:center;padding:8px 2px;font-size:.7rem;font-weight:700;color:var(--text3)}
.cal-day{background:var(--card);text-align:center;padding:8px 2px;font-size:.82rem;cursor:pointer;transition:background .2s;min-height:50px;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;gap:2px}
.cal-day:hover{background:var(--bg2)}
.cal-day.today{background:rgba(45,122,58,.15)}
.cal-day.today .day-num{background:var(--accent);color:#fff;border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-weight:700}
.cal-day.empty{background:var(--bg);cursor:default}
.cal-event-dot{width:5px;height:5px;border-radius:50%}
.season-badge{display:inline-block;padding:3px 10px;border-radius:20px;font-size:.72rem;font-weight:700}
.season-rabi{background:rgba(231,76,60,.15);color:#c0392b}
.season-kharif{background:rgba(39,174,96,.15);color:#27ae60}
.season-zaid{background:rgba(243,156,18,.15);color:#e67e22}
.crop-calendar{background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden}
.crop-table{width:100%;border-collapse:collapse}
.crop-table th{background:var(--bg2);padding:10px 12px;text-align:left;font-size:.8rem;font-weight:700;color:var(--text3);border-bottom:1px solid var(--border)}
.crop-table td{padding:10px 12px;border-bottom:1px solid var(--border);font-size:.84rem;color:var(--text2);vertical-align:top}
.crop-table tr:last-child td{border-bottom:none}
.crop-table tr:hover td{background:var(--bg2)}
.scheme-card{background:var(--card);border:1px solid var(--border);border-radius:14px;margin-bottom:12px;overflow:hidden;cursor:pointer;transition:box-shadow .2s}
.scheme-card:hover{box-shadow:0 4px 16px var(--shadow)}
.scheme-header{display:flex;align-items:center;gap:12px;padding:14px 16px}
.scheme-icon{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
.scheme-title{flex:1}
.scheme-title h3{font-size:.9rem;font-weight:700;color:var(--text);margin-bottom:2px}
.scheme-title p{font-size:.75rem;color:var(--text3)}
.scheme-chevron{font-size:14px;color:var(--text3);transition:transform .2s}
.scheme-card.open .scheme-chevron{transform:rotate(90deg)}
.scheme-body{display:none;padding:0 16px 14px;border-top:1px dashed var(--border)}
.scheme-card.open .scheme-body{display:block}
.scheme-detail{font-size:.82rem;color:var(--text2);line-height:1.6;padding-top:10px}
.scheme-tag{display:inline-block;padding:3px 10px;border-radius:20px;font-size:.72rem;font-weight:600;margin-right:6px;margin-top:6px}
.tag-green{background:rgba(39,174,96,.15);color:#27ae60}
.tag-blue{background:rgba(41,128,185,.15);color:#2980b9}
.tag-orange{background:rgba(224,123,26,.15);color:#d35400}
.knowledge-section{margin-bottom:20px}
.knowledge-section h2{font-size:1rem;font-weight:700;color:var(--accent);margin-bottom:12px;display:flex;align-items:center;gap:8px;padding-bottom:8px;border-bottom:2px solid var(--border)}
.faq-item{background:var(--card);border:1px solid var(--border);border-radius:12px;margin-bottom:8px;overflow:hidden}
.faq-q{padding:12px 14px;font-size:.86rem;font-weight:600;cursor:pointer;display:flex;justify-content:space-between;align-items:center;color:var(--text)}
.faq-q:hover{background:var(--bg2)}
.faq-a{display:none;padding:0 14px 12px;font-size:.82rem;color:var(--text2);line-height:1.6;border-top:1px dashed var(--border)}
.faq-item.open .faq-a{display:block;padding-top:10px}
.faq-item.open .faq-chevron{transform:rotate(180deg)}
.faq-chevron{font-size:12px;transition:transform .2s}
.about-hero{background:linear-gradient(135deg,var(--accent),var(--leaf));border-radius:18px;padding:24px;color:#fff;margin-bottom:16px;text-align:center}
.about-hero h2{font-size:1.4rem;font-weight:800;margin-bottom:6px}
.about-hero p{opacity:.9;font-size:.88rem;line-height:1.6}
.feature-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:16px}
.feature-card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;text-align:center}
.feature-icon{font-size:2rem;margin-bottom:8px}
.feature-card h4{font-size:.82rem;font-weight:700;color:var(--text);margin-bottom:4px}
.feature-card p{font-size:.75rem;color:var(--text3);line-height:1.4}
.bandwidth-bar{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:16px}
.bandwidth-bar h3{font-size:.9rem;font-weight:700;color:var(--text);margin-bottom:14px}
.bw-row{margin-bottom:12px}
.bw-label{font-size:.78rem;color:var(--text3);margin-bottom:4px;display:flex;justify-content:space-between}
.bw-track{background:var(--bg2);border-radius:8px;height:10px;overflow:hidden}
.bw-fill{height:100%;border-radius:8px}
.bw-high{background:linear-gradient(90deg,#c0392b,#e74c3c);width:100%}
.bw-low{background:linear-gradient(90deg,var(--accent),var(--leaf));width:30%}
.section-title{font-size:1rem;font-weight:700;color:var(--text);margin-bottom:12px;display:flex;align-items:center;gap:8px}
.toast{position:fixed;bottom:20px;right:20px;background:var(--accent);color:#fff;padding:10px 18px;border-radius:12px;font-size:.84rem;font-weight:600;z-index:999;opacity:0;transform:translateY(20px);transition:all .3s}
.toast.show{opacity:1;transform:translateY(0)}
.typing-dots span{display:inline-block;width:7px;height:7px;background:var(--text3);border-radius:50%;margin:0 2px;animation:bounce 1.2s infinite}
.typing-dots span:nth-child(2){animation-delay:.2s}
.typing-dots span:nth-child(3){animation-delay:.4s}
@keyframes bounce{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-6px)}}
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:var(--bg2)}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
@media(max-width:600px){.feature-grid{grid-template-columns:1fr}}
</style>
</head>
<body>

<div class="header">
  <div class="header-inner">
    <div class="logo-area">
      <div class="logo-icon">ЁЯМ╛</div>
      <div class="logo-text">
        <h1>Gram Sahayak AI</h1>
        <p>рдЧреНрд░рд╛рдо рд╕рд╣рд╛рдпрдХ тАв Rural AI Assistant</p>
      </div>
    </div>
    <div class="header-controls">
      <div class="ai-badge"><div class="ai-dot"></div><span>Claude AI</span></div>
      <button class="lang-toggle" onclick="toggleLang()" id="langBtn">рд╣рд┐рдВ/EN</button>
      <button class="btn-icon" onclick="toggleTheme()" id="themeBtn">ЁЯМЩ</button>
    </div>
  </div>
</div>

<div class="status-bar">
  <div class="status-item"><div class="dot dot-green"></div><span id="s1">AI Mode рд╕рдХреНрд░рд┐рдп</span></div>
  <div class="status-item"><div class="dot dot-yellow"></div><span id="s2">рдХреИрд╢: 128KB</span></div>
  <div class="status-item"><div class="dot dot-green"></div><span id="s3">рдбреЗрдЯрд╛ рдмрдЪрдд: 64%</span></div>
  <div class="status-item">ЁЯУ╢ <span id="s4">рдХрдо-рдмреИрдВрдбрд╡рд┐рдбреНрде рдореЛрдб</span></div>
</div>

<div style="background:var(--bg2);border-bottom:2px solid var(--border);">
<div class="tabs" id="tabs">
  <div class="tab active" onclick="showTab('chat',this)">ЁЯТм <span class="tlbl" data-hi="рд╕рд╣рд╛рдпрдХ" data-en="Assistant">рд╕рд╣рд╛рдпрдХ</span></div>
  <div class="tab" onclick="showTab('weather',this)">ЁЯМдя╕П <span class="tlbl" data-hi="рдореМрд╕рдо" data-en="Weather">рдореМрд╕рдо</span></div>
  <div class="tab" onclick="showTab('calendar',this)">ЁЯУЕ <span class="tlbl" data-hi="рдХреИрд▓реЗрдВрдбрд░" data-en="Calendar">рдХреИрд▓реЗрдВрдбрд░</span></div>
  <div class="tab" onclick="showTab('schemes',this)">ЁЯПЫя╕П <span class="tlbl" data-hi="рдпреЛрдЬрдирд╛рдПрдВ" data-en="Schemes">рдпреЛрдЬрдирд╛рдПрдВ</span></div>
  <div class="tab" onclick="showTab('knowledge',this)">ЁЯУЪ <span class="tlbl" data-hi="рдЬреНрдЮрд╛рди" data-en="Knowledge">рдЬреНрдЮрд╛рди</span></div>
  <div class="tab" onclick="showTab('about',this)">тД╣я╕П <span class="tlbl" data-hi="рдкрд░рд┐рдЪрдп" data-en="About">рдкрд░рд┐рдЪрдп</span></div>
</div>
</div>

<div class="main">

<!-- CHAT -->
<div class="tab-content active" id="tab-chat">
  <div class="chat-container">
    <div class="chat-messages" id="chatMessages">
      <div class="msg bot">
        <div class="msg-avatar">ЁЯМ╛</div>
        <div>
          <div class="msg-bubble">
            ЁЯЩП <strong>рдирдорд╕реНрддреЗ! рдореИрдВ рдЧреНрд░рд╛рдо рд╕рд╣рд╛рдпрдХ AI рд╣реВрдБред</strong><br><br>
            ЁЯМ╛ рдлрд╕рд▓ рдФрд░ рдЦреЗрддреА рдХреА рдЬрд╛рдирдХрд╛рд░реА<br>
            ЁЯПЫя╕П рд╕рд░рдХрд╛рд░реА рдпреЛрдЬрдирд╛рдПрдВ<br>
            ЁЯМдя╕П рдореМрд╕рдо рдХреА рд╕рд▓рд╛рд╣<br>
            ЁЯРД рдкрд╢реБрдкрд╛рд▓рди рд╕рд╣рд╛рдпрддрд╛<br><br>
            <em>Claude AI powered тАФ Hindi &amp; English both!</em>
          </div>
          <div class="msg-time">рдЕрднреА тАв Now</div>
          <div class="quick-chips" id="quickChips">
            <div class="chip" onclick="sendChip(this)">ЁЯМ╛ рдЧреЗрд╣реВрдВ рдХреА рдмреБрдЖрдИ</div>
            <div class="chip" onclick="sendChip(this)">ЁЯТ░ PM-KISAN рдЬрд╛рдирдХрд╛рд░реА</div>
            <div class="chip" onclick="sendChip(this)">ЁЯМзя╕П рдореМрд╕рдо рд╕рд▓рд╛рд╣</div>
            <div class="chip" onclick="sendChip(this)">ЁЯРД рдкрд╢реБрдкрд╛рд▓рди</div>
            <div class="chip" onclick="sendChip(this)">Wheat sowing tips</div>
            <div class="chip" onclick="sendChip(this)">Crop insurance</div>
          </div>
        </div>
      </div>
    </div>
    <div class="chat-input-area">
      <div class="ai-mode-bar">
        <span id="aiModeLabel">ЁЯдЦ Claude AI Mode (Smart answers)</span>
        <div class="ai-toggle-row">
          <span id="aiToggleLabel" style="font-size:.7rem">AI On</span>
          <label class="toggle-switch">
            <input type="checkbox" id="aiToggle" checked onchange="updateAIMode()">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      <div class="chat-input-row">
        <textarea class="chat-input" id="chatInput" placeholder="рдЕрдкрдирд╛ рд╕рд╡рд╛рд▓ рдкреВрдЫреЗрдВ... / Ask your question..." rows="2" onkeydown="handleKey(event)"></textarea>
        <button class="send-btn" id="sendBtn" onclick="sendMessage()">тЮд</button>
      </div>
      <div class="data-usage">ЁЯУК Data: <span id="dataCounter">0.2KB</span> | Cache hits: <span id="cacheHits">0</span> | AI calls: <span id="aiCalls">0</span></div>
    </div>
  </div>
</div>

<!-- WEATHER -->
<div class="tab-content" id="tab-weather">
  <button class="fetch-weather-btn" onclick="fetchWeather()">ЁЯУН <span id="wBtnTxt">рдЕрдкрдирд╛ рдореМрд╕рдо рджреЗрдЦреЗрдВ / Get My Weather</span></button>
  <div id="weatherDisplay" style="display:none">
    <div class="weather-card">
      <div class="weather-main">
        <div>
          <div class="weather-location" id="wLoc">Lucknow, UP</div>
          <div class="weather-temp" id="wTemp">28┬░C</div>
          <div class="weather-desc" id="wDesc">рдЖрдВрд╢рд┐рдХ рдмрд╛рджрд▓ / Partly Cloudy</div>
        </div>
        <div class="weather-icon-big" id="wIcon">тЫЕ</div>
      </div>
      <div class="weather-grid">
        <div class="weather-stat"><div class="weather-stat-val" id="wHum">65%</div><div class="weather-stat-lbl" id="wHumLbl">рдирдореА / Humidity</div></div>
        <div class="weather-stat"><div class="weather-stat-val" id="wWnd">12 km/h</div><div class="weather-stat-lbl" id="wWndLbl">рд╣рд╡рд╛ / Wind</div></div>
        <div class="weather-stat"><div class="weather-stat-val" id="wUV">5</div><div class="weather-stat-lbl">UV Index</div></div>
      </div>
    </div>
    <div class="weather-advice">
      <h3>ЁЯМ╛ <span id="advTitle">рдЖрдЬ рдХреА рдЦреЗрддреА рд╕рд▓рд╛рд╣ / Today's Farming Advice</span></h3>
      <div id="farmingAdvice"></div>
    </div>
  </div>
  <div class="weather-advice">
    <h3 id="seasGuideTitle">ЁЯУЕ рдореМрд╕рдо рдЖрдзрд╛рд░рд┐рдд рдХреГрд╖рд┐ рдЧрд╛рдЗрдб / Seasonal Farming Guide</h3>
    <div class="advice-item">ЁЯМбя╕П <strong>30┬░C+:</strong> <span id="adv1">рд╕рд┐рдВрдЪрд╛рдИ рдмрдврд╝рд╛рдПрдВ, рджреЛрдкрд╣рд░ рдореЗрдВ рдХрд╛рдо рди рдХрд░реЗрдВ / Increase irrigation, avoid afternoon work</span></div>
    <div class="advice-item">ЁЯМзя╕П <strong id="adv2l">рдмрд╛рд░рд┐рд╢:</strong> <span id="adv2">рдХреАрдЯрдирд╛рд╢рдХ рд╕реНрдкреНрд░реЗ рдмрдВрдж рд░рдЦреЗрдВ / Stop pesticide spray during rain</span></div>
    <div class="advice-item">тЭДя╕П <strong id="adv3l">рдкрд╛рд▓рд╛:</strong> <span id="adv3">рдлрд╕рд▓реЛрдВ рдХреЛ рдврдХреЗрдВ, рд░рд╛рдд рдХреЛ рд╕рд┐рдВрдЪрд╛рдИ рдХрд░реЗрдВ / Cover crops, irrigate at night</span></div>
    <div class="advice-item">ЁЯТи <strong id="adv4l">рддреЗрдЬ рд╣рд╡рд╛:</strong> <span id="adv4">рдЫрд┐рдбрд╝рдХрд╛рд╡ рди рдХрд░реЗрдВ / Avoid spraying in strong winds</span></div>
    <div class="advice-item">тШАя╕П <strong id="adv5l">рдзреВрдк:</strong> <span id="adv5">рдЦрд╛рдж рдХрд╛ рдкреНрд░рдпреЛрдЧ рдХрд░реЗрдВ / Apply fertilizers in sunshine</span></div>
  </div>
</div>

<!-- CALENDAR -->
<div class="tab-content" id="tab-calendar">
  <div class="calendar-card">
    <div class="calendar-header-row">
      <button class="cal-nav-btn" onclick="changeMonth(-1)">тЧА</button>
      <div>
        <div class="cal-month-title" id="calM1"></div>
        <div class="cal-month-title" id="calM2" style="font-size:.78rem;opacity:.85"></div>
      </div>
      <button class="cal-nav-btn" onclick="changeMonth(1)">тЦ╢</button>
    </div>
    <div class="cal-grid" id="calGrid"></div>
  </div>
  <div class="section-title" id="cropCalTitle">ЁЯМ╛ рдлрд╕рд▓ рдХреИрд▓реЗрдВрдбрд░ / Crop Calendar</div>
  <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px">
    <span class="season-badge season-rabi" id="badgeRabi">рд░рдмреА Rabi (Oct-Mar)</span>
    <span class="season-badge season-kharif" id="badgeKharif">рдЦрд░реАрдл Kharif (Jun-Oct)</span>
    <span class="season-badge season-zaid" id="badgeZaid">рдЬрд╛рдпрдж Zaid (Mar-Jun)</span>
  </div>
  <div class="crop-calendar">
    <table class="crop-table">
      <thead><tr>
        <th id="thMonth">рдорд╛рд╣ / Month</th>
        <th id="thSeason">рд╕реАрдЬрди / Season</th>
        <th id="thActivity">рдЧрддрд┐рд╡рд┐рдзрд┐ / Activity</th>
        <th id="thCrops">рдлрд╕рд▓ / Crops</th>
      </tr></thead>
      <tbody id="cropTbody"></tbody>
    </table>
  </div>
</div>

<!-- SCHEMES -->
<div class="tab-content" id="tab-schemes">
  <div class="section-title" id="schemesTitle">ЁЯПЫя╕П рд╕рд░рдХрд╛рд░реА рдпреЛрдЬрдирд╛рдПрдВ / Government Schemes</div>
  <div id="schemesContainer"></div>
</div>

<!-- KNOWLEDGE -->
<div class="tab-content" id="tab-knowledge">
  <div class="knowledge-section">
    <h2 id="farmKnowTitle">ЁЯМ╛ рдЦреЗрддреА рдХреА рдЬрд╛рдирдХрд╛рд░реА / Farming Knowledge</h2>
    <div id="farmingFAQ"></div>
  </div>
  <div class="knowledge-section">
    <h2 id="animalKnowTitle">ЁЯРД рдкрд╢реБрдкрд╛рд▓рди / Animal Husbandry</h2>
    <div id="animalFAQ"></div>
  </div>
  <div class="knowledge-section">
    <h2 id="emergTitle">ЁЯЪС рдЖрдкрд╛рддрдХрд╛рд▓ рд╕рдВрдкрд░реНрдХ / Emergency Contacts</h2>
    <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px">
      <div class="advice-item">ЁЯУЮ <strong>Kisan Call Center:</strong> 1800-180-1551 (Free)</div>
      <div class="advice-item">ЁЯУЮ <strong>PM-KISAN Helpline:</strong> 155261</div>
      <div class="advice-item">ЁЯУЮ <strong>Crop Insurance:</strong> 1800-200-7710</div>
      <div class="advice-item">ЁЯУЮ <strong>Soil Health:</strong> 1800-180-1551</div>
      <div class="advice-item">ЁЯМР <strong>PM-KISAN Portal:</strong> pmkisan.gov.in</div>
      <div class="advice-item">ЁЯМР <strong>e-NAM:</strong> enam.gov.in</div>
    </div>
  </div>
</div>

<!-- ABOUT -->
<div class="tab-content" id="tab-about">
  <div class="about-hero">
    <div style="font-size:3rem;margin-bottom:8px">ЁЯМ╛</div>
    <h2>Gram Sahayak AI</h2>
    <p id="aboutD1">рдЧреНрд░рд╛рдо рд╕рд╣рд╛рдпрдХ AI тАФ рднрд╛рд░рдд рдХреЗ рдХрд┐рд╕рд╛рдиреЛрдВ рдХреЗ рд▓рд┐рдП Claude AI рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд</p>
    <p id="aboutD2" style="margin-top:8px;font-size:.8rem">India's Low-Bandwidth AI Assistant тАФ Powered by Claude AI for Rural Farmers</p>
  </div>
  <div class="bandwidth-bar">
    <h3>ЁЯУК Bandwidth Comparison</h3>
    <div class="bw-row">
      <div class="bw-label"><span id="bwL1">Traditional AI Assistant</span><span style="color:#c0392b">100% data usage</span></div>
      <div class="bw-track"><div class="bw-fill bw-high"></div></div>
    </div>
    <div class="bw-row">
      <div class="bw-label"><span>Gram Sahayak AI</span><span style="color:var(--accent)">~30% (70% saved!)</span></div>
      <div class="bw-track"><div class="bw-fill bw-low"></div></div>
    </div>
  </div>
  <div class="feature-grid">
    <div class="feature-card"><div class="feature-icon">ЁЯдЦ</div><h4 id="f1t">Claude AI Powered</h4><p id="f1d">Real AI answers тАФ understands Hindi & English</p></div>
    <div class="feature-card"><div class="feature-icon">ЁЯТ╛</div><h4 id="f2t">Smart Caching</h4><p id="f2d">Saves responses locally, avoids re-fetching</p></div>
    <div class="feature-card"><div class="feature-icon">ЁЯУ╢</div><h4 id="f3t">2G Compatible</h4><p id="f3d">Minimal data, works on slow networks</p></div>
    <div class="feature-card"><div class="feature-icon">ЁЯМР</div><h4 id="f4t">Bilingual</h4><p id="f4d">Full Hindi & English support</p></div>
    <div class="feature-card"><div class="feature-icon">ЁЯМ╛</div><h4 id="f5t">Agri Knowledge</h4><p id="f5d">ICAR-based guide for North India / UP</p></div>
    <div class="feature-card"><div class="feature-icon">ЁЯПЫя╕П</div><h4 id="f6t">12 Gov Schemes</h4><p id="f6d">All major farmer government schemes</p></div>
  </div>
  <div class="weather-advice">
    <h3 id="probTitle">ЁЯОп Problem We Solve</h3>
    <div class="advice-item" id="p1">тЭМ Rural areas have 2G/weak 3G connectivity</div>
    <div class="advice-item" id="p2">тЭМ Expensive mobile data plans</div>
    <div class="advice-item" id="p3">тЭМ Low-end smartphones with limited power</div>
    <div class="advice-item" id="s1t">тЬЕ Claude AI gives real intelligent farming answers</div>
    <div class="advice-item" id="s2t">тЬЕ Offline fallback when no internet</div>
    <div class="advice-item" id="s3t">тЬЕ Scalable for Smart Village initiatives</div>
  </div>
</div>

</div>
<div class="toast" id="toast"></div>

<script>
// STATE
let lang = 'hi', isDark = false, calY = new Date().getFullYear(), calM = new Date().getMonth();
let dataBytes = 200, cacheHits = 0, aiCalls = 0, isAI = true, sending = false;
const cache = {}, history = [];

// TRANSLATIONS
const T = {
  hi: {
    s1:'AI Mode рд╕рдХреНрд░рд┐рдп', s2:'рдХреИрд╢: 128KB', s3:'рдбреЗрдЯрд╛ рдмрдЪрдд: 64%', s4:'рдХрдо-рдмреИрдВрдбрд╡рд┐рдбреНрде рдореЛрдб',
    wBtnTxt:'рдЕрдкрдирд╛ рдореМрд╕рдо рджреЗрдЦреЗрдВ', advTitle:'рдЖрдЬ рдХреА рдЦреЗрддреА рд╕рд▓рд╛рд╣', seasGuideTitle:'ЁЯУЕ рдореМрд╕рдо рдЖрдзрд╛рд░рд┐рдд рдХреГрд╖рд┐ рдЧрд╛рдЗрдб',
    adv1:'рд╕рд┐рдВрдЪрд╛рдИ рдмрдврд╝рд╛рдПрдВ, рджреЛрдкрд╣рд░ рдореЗрдВ рдХрд╛рдо рди рдХрд░реЗрдВ', adv2l:'рдмрд╛рд░рд┐рд╢:', adv2:'рдХреАрдЯрдирд╛рд╢рдХ рд╕реНрдкреНрд░реЗ рдмрдВрдж рд░рдЦреЗрдВ',
    adv3l:'рдкрд╛рд▓рд╛:', adv3:'рдлрд╕рд▓реЛрдВ рдХреЛ рдврдХреЗрдВ, рд░рд╛рдд рдХреЛ рд╕рд┐рдВрдЪрд╛рдИ рдХрд░реЗрдВ', adv4l:'рддреЗрдЬ рд╣рд╡рд╛:', adv4:'рдЫрд┐рдбрд╝рдХрд╛рд╡ рди рдХрд░реЗрдВ',
    adv5l:'рдзреВрдк:', adv5:'рдЦрд╛рдж рдХрд╛ рдкреНрд░рдпреЛрдЧ рдХрд░реЗрдВ',
    cropCalTitle:'ЁЯМ╛ рдлрд╕рд▓ рдХреИрд▓реЗрдВрдбрд░', badgeRabi:'рд░рдмреА (рдЕрдХреНрдЯреВрдмрд░-рдорд╛рд░реНрдЪ)', badgeKharif:'рдЦрд░реАрдл (рдЬреВрди-рдЕрдХреНрдЯреВрдмрд░)', badgeZaid:'рдЬрд╛рдпрдж (рдорд╛рд░реНрдЪ-рдЬреВрди)',
    thMonth:'рдорд╛рд╣', thSeason:'рд╕реАрдЬрди', thActivity:'рдЧрддрд┐рд╡рд┐рдзрд┐', thCrops:'рдлрд╕рд▓',
    schemesTitle:'ЁЯПЫя╕П рд╕рд░рдХрд╛рд░реА рдпреЛрдЬрдирд╛рдПрдВ', farmKnowTitle:'ЁЯМ╛ рдЦреЗрддреА рдХреА рдЬрд╛рдирдХрд╛рд░реА', animalKnowTitle:'ЁЯРД рдкрд╢реБрдкрд╛рд▓рди', emergTitle:'ЁЯЪС рдЖрдкрд╛рддрдХрд╛рд▓ рд╕рдВрдкрд░реНрдХ',
    aboutD1:'рдЧреНрд░рд╛рдо рд╕рд╣рд╛рдпрдХ AI тАФ рднрд╛рд░рдд рдХреЗ рдХрд┐рд╕рд╛рдиреЛрдВ рдХреЗ рд▓рд┐рдП Claude AI рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд', aboutD2:'рднрд╛рд░рдд рдХрд╛ рдХрдо-рдмреИрдВрдбрд╡рд┐рдбреНрде AI рд╕рд╣рд╛рдпрдХ тАФ рдЧреНрд░рд╛рдореАрдг рдХрд┐рд╕рд╛рдиреЛрдВ рдХреЗ рд▓рд┐рдП',
    bwL1:'рдкрд╛рд░рдВрдкрд░рд┐рдХ AI рд╕рд╣рд╛рдпрдХ', probTitle:'ЁЯОп рд╣рдо рдХреНрдпрд╛ рд╕реБрд▓рдЭрд╛рддреЗ рд╣реИрдВ',
    p1:'тЭМ рдЧреНрд░рд╛рдореАрдг рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ 2G/рдХрдордЬреЛрд░ рдиреЗрдЯрд╡рд░реНрдХ', p2:'тЭМ рдорд╣рдВрдЧреЗ рдореЛрдмрд╛рдЗрд▓ рдбреЗрдЯрд╛ рдкреНрд▓рд╛рди', p3:'тЭМ рдХрдо рдХреНрд╖рдорддрд╛ рд╡рд╛рд▓реЗ рд╕реНрдорд╛рд░реНрдЯрдлреЛрди',
    s1t:'тЬЕ Claude AI рдЕрд╕рд▓реА рдЦреЗрддреА рдХреЗ рд╕рд╡рд╛рд▓реЛрдВ рдХреЗ рдЬрд╡рд╛рдм рджреЗрддрд╛ рд╣реИ', s2t:'тЬЕ рдЗрдВрдЯрд░рдиреЗрдЯ рди рд╣реЛ рддреЛ рдСрдлрд▓рд╛рдЗрди рдЬрд╛рдирдХрд╛рд░реА рднреА', s3t:'тЬЕ рд╕реНрдорд╛рд░реНрдЯ рд╡рд┐рд▓реЗрдЬ рдкрд╣рд▓ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд',
    f1t:'Claude AI рд╕рдВрдЪрд╛рд▓рд┐рдд', f1d:'рдЕрд╕рд▓реА AI рдЬрд╡рд╛рдм тАФ рд╣рд┐рдВрджреА рдФрд░ рдЕрдВрдЧреНрд░реЗрдЬреА рджреЛрдиреЛрдВ рдореЗрдВ', f2t:'рд╕реНрдорд╛рд░реНрдЯ рдХреИрд╢рд┐рдВрдЧ', f2d:'рдЙрддреНрддрд░ рд╕рд╣реЗрдЬрддрд╛ рд╣реИ, рдмрд╛рд░-рдмрд╛рд░ рдбреЗрдЯрд╛ рдирд╣реАрдВ рд▓реЗрддрд╛',
    f3t:'2G рд╕рдВрдЧрдд', f3d:'рдзреАрдореЗ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рднреА рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ', f4t:'рджреНрд╡рд┐рднрд╛рд╖реА', f4d:'рд╕рднреА рдХрд┐рд╕рд╛рдиреЛрдВ рдХреЗ рд▓рд┐рдП рд╣рд┐рдВрджреА рдФрд░ рдЕрдВрдЧреНрд░реЗрдЬреА',
    f5t:'рдХреГрд╖рд┐ рдЬреНрдЮрд╛рди', f5d:'ICAR рдЖрдзрд╛рд░рд┐рдд рдЙрддреНрддрд░ рднрд╛рд░рдд рдХреА рдЦреЗрддреА рдЧрд╛рдЗрдб', f6t:'12 рд╕рд░рдХрд╛рд░реА рдпреЛрдЬрдирд╛рдПрдВ', f6d:'рд╕рднреА рдкреНрд░рдореБрдЦ рдХрд┐рд╕рд╛рди рдпреЛрдЬрдирд╛рдПрдВ',
    aiModeLabel:'ЁЯдЦ Claude AI рдореЛрдб (рд╕реНрдорд╛рд░реНрдЯ рдЬрд╡рд╛рдм)', aiToggleLabel:'AI рдЪрд╛рд▓реВ', aiModeOff:'ЁЯУ╡ рдСрдлрд▓рд╛рдЗрди рдореЛрдб', aiToggleOff:'AI рдмрдВрдж',
    wHumLbl:'рдирдореА', wWndLbl:'рд╣рд╡рд╛',
  },
  en: {
    s1:'AI Mode Active', s2:'Cache: 128KB', s3:'Data saved: 64%', s4:'Low-BW Mode',
    wBtnTxt:'Get My Weather', advTitle:"Today's Farming Advice", seasGuideTitle:'ЁЯУЕ Seasonal Farming Guide',
    adv1:'Increase irrigation, avoid afternoon work', adv2l:'Rain:', adv2:'Stop pesticide spray during rain',
    adv3l:'Frost:', adv3:'Cover crops, irrigate at night', adv4l:'Strong Wind:', adv4:'Avoid spraying in strong winds',
    adv5l:'Sunshine:', adv5:'Apply fertilizers in sunshine',
    cropCalTitle:'ЁЯМ╛ Crop Calendar', badgeRabi:'Rabi (Oct-Mar)', badgeKharif:'Kharif (Jun-Oct)', badgeZaid:'Zaid (Mar-Jun)',
    thMonth:'Month', thSeason:'Season', thActivity:'Activity', thCrops:'Crops',
    schemesTitle:'ЁЯПЫя╕П Government Schemes', farmKnowTitle:'ЁЯМ╛ Farming Knowledge', animalKnowTitle:'ЁЯРД Animal Husbandry', emergTitle:'ЁЯЪС Emergency Contacts',
    aboutD1:'Gram Sahayak AI тАФ Powered by Claude AI for Indian Farmers', aboutD2:"India's Low-Bandwidth AI Assistant for Rural Farmers",
    bwL1:'Traditional AI Assistant', probTitle:'ЁЯОп Problem We Solve',
    p1:'тЭМ Rural areas have 2G/weak 3G connectivity', p2:'тЭМ Expensive mobile data plans', p3:'тЭМ Low-end smartphones with limited power',
    s1t:'тЬЕ Claude AI gives real intelligent farming answers', s2t:'тЬЕ Offline fallback when no internet', s3t:'тЬЕ Scalable for Smart Village initiatives',
    f1t:'Claude AI Powered', f1d:'Real AI answers тАФ understands Hindi & English', f2t:'Smart Caching', f2d:'Saves responses locally, avoids re-fetching',
    f3t:'2G Compatible', f3d:'Works on slow networks', f4t:'Bilingual', f4d:'Full Hindi & English support',
    f5t:'Agri Knowledge', f5d:'ICAR-based guide for North India / UP', f6t:'12 Gov Schemes', f6d:'All major farmer government schemes',
    aiModeLabel:'ЁЯдЦ Claude AI Mode (Smart answers)', aiToggleLabel:'AI On', aiModeOff:'ЁЯУ╡ Offline Mode', aiToggleOff:'AI Off',
    wHumLbl:'Humidity', wWndLbl:'Wind',
  }
};

// DATA
const hiM=['рдЬрдирд╡рд░реА','рдлрд░рд╡рд░реА','рдорд╛рд░реНрдЪ','рдЕрдкреНрд░реИрд▓','рдордИ','рдЬреВрди','рдЬреБрд▓рд╛рдИ','рдЕрдЧрд╕реНрдд','рд╕рд┐рддрдВрдмрд░','рдЕрдХреНрдЯреВрдмрд░','рдирд╡рдВрдмрд░','рджрд┐рд╕рдВрдмрд░'];
const enM=['January','February','March','April','May','June','July','August','September','October','November','December'];
const hiD=['рд░','рд╕','рдо','рдмреБ','рдЧреБ','рд╢реБ','рд╢'];
const enD=['Su','Mo','Tu','We','Th','Fr','Sa'];
const evts={0:['#e07b1a'],1:['#27ae60'],2:['#f39c12'],3:['#f39c12'],4:['#f39c12'],5:['#27ae60'],6:['#27ae60'],7:['#27ae60'],8:['#27ae60'],9:['#c0392b'],10:['#c0392b'],11:['#c0392b']};

const cropRows=[
  {mh:'рдЕрдХреНрдЯреВрдмрд░',me:'October',s:'rabi',sh:'рд░рдмреА',se:'Rabi',ah:'рдмреБрдЖрдИ',ae:'Sowing',c:'ЁЯМ╛ рдЧреЗрд╣реВрдВ/Wheat, ЁЯМ╗ рд╕рд░рд╕реЛрдВ/Mustard'},
  {mh:'рдирд╡рдВрдмрд░',me:'November',s:'rabi',sh:'рд░рдмреА',se:'Rabi',ah:'рд╕рд┐рдВрдЪрд╛рдИ, рдЦрд╛рдж',ae:'Irrigation, Fertilizer',c:'ЁЯМ╛ рдЧреЗрд╣реВрдВ/Wheat, ЁЯМ╗ рд╕рд░рд╕реЛрдВ/Mustard'},
  {mh:'рджрд┐рд╕рдВрдмрд░',me:'December',s:'rabi',sh:'рд░рдмреА',se:'Rabi',ah:'рдЦрд░рдкрддрд╡рд╛рд░ рдирд┐рдпрдВрддреНрд░рдг',ae:'Weed control',c:'ЁЯМ╛ рдЧреЗрд╣реВрдВ/Wheat, ЁЯеФ рдЖрд▓реВ/Potato'},
  {mh:'рдЬрдирд╡рд░реА',me:'January',s:'rabi',sh:'рд░рдмреА',se:'Rabi',ah:'рд░реЛрдЧ рдирд┐рдпрдВрддреНрд░рдг',ae:'Disease control',c:'ЁЯМ╛ рдЧреЗрд╣реВрдВ/Wheat, ЁЯЯв рдордЯрд░/Peas'},
  {mh:'рдлрд░рд╡рд░реА',me:'February',s:'rabi',sh:'рд░рдмреА',se:'Rabi',ah:'рдХрдЯрд╛рдИ',ae:'Harvesting',c:'ЁЯМ╗ рд╕рд░рд╕реЛрдВ/Mustard'},
  {mh:'рдорд╛рд░реНрдЪ',me:'March',s:'rabi',sh:'рд░рдмреА',se:'Rabi',ah:'рдХрдЯрд╛рдИ',ae:'Harvesting',c:'ЁЯМ╛ рдЧреЗрд╣реВрдВ/Wheat'},
  {mh:'рдЕрдкреНрд░реИрд▓',me:'April',s:'zaid',sh:'рдЬрд╛рдпрдж',se:'Zaid',ah:'рд╕рдмреНрдЬреА рдЦреЗрддреА',ae:'Vegetables',c:'ЁЯеТ рдЦреАрд░рд╛/Cucumber, ЁЯНЙ рддрд░рдмреВрдЬ/Watermelon'},
  {mh:'рдордИ',me:'May',s:'zaid',sh:'рдЬрд╛рдпрдж',se:'Zaid',ah:'рд╕рд┐рдВрдЪрд╛рдИ, рдХрдЯрд╛рдИ',ae:'Irrigation, Harvest',c:'ЁЯНЙ рддрд░рдмреВрдЬ/Watermelon'},
  {mh:'рдЬреВрди',me:'June',s:'kharif',sh:'рдЦрд░реАрдл',se:'Kharif',ah:'рднреВрдорд┐ рддреИрдпрд╛рд░реА, рдирд░реНрд╕рд░реА',ae:'Land prep, Nursery',c:'ЁЯМ╛ рдзрд╛рди/Paddy'},
  {mh:'рдЬреБрд▓рд╛рдИ',me:'July',s:'kharif',sh:'рдЦрд░реАрдл',se:'Kharif',ah:'рд░реЛрдкрд╛рдИ',ae:'Transplantation',c:'ЁЯМ╛ рдзрд╛рди/Paddy, ЁЯМ╜ рдордХреНрдХрд╛/Maize'},
  {mh:'рдЕрдЧрд╕реНрдд',me:'August',s:'kharif',sh:'рдЦрд░реАрдл',se:'Kharif',ah:'рдЦрд╛рдж, рдЦрд░рдкрддрд╡рд╛рд░',ae:'Fertilizer, Weed',c:'ЁЯМ╛ рдзрд╛рди/Paddy, ЁЯлШ рдЕрд░рд╣рд░/Pigeon Pea'},
  {mh:'рд╕рд┐рддрдВрдмрд░',me:'September',s:'kharif',sh:'рдЦрд░реАрдл',se:'Kharif',ah:'рдХреАрдЯ рдкреНрд░рдмрдВрдзрди',ae:'Pest management',c:'ЁЯМ╛ рдзрд╛рди/Paddy, ЁЯеЬ рдореВрдВрдЧрдлрд▓реА/Groundnut'},
];

const schemes=[
  {i:'ЁЯТ░',c:'#27ae60',nh:'PM-KISAN рд╕рдореНрдорд╛рди рдирд┐рдзрд┐',ne:'PM-KISAN Samman Nidhi',sub:'Pradhan Mantri Kisan Samman Nidhi',d:`<strong>рд▓рд╛рдн/Benefit:</strong> тВ╣6,000/year in 3 installments (тВ╣2,000 each)<br><br><strong>рдкрд╛рддреНрд░рддрд╛/Eligibility:</strong> All eligible landholding farmer families<br><br><strong>Apply:</strong> pmkisan.gov.in рдпрд╛ CSC center<br><strong>Helpline:</strong> 155261<br><span class="scheme-tag tag-green">тВ╣6,000/year</span><span class="scheme-tag tag-blue">DBT</span><span class="scheme-tag tag-orange">Since 2019</span>`},
  {i:'ЁЯМ╛',c:'#e07b1a',nh:'PM рдлрд╕рд▓ рдмреАрдорд╛ рдпреЛрдЬрдирд╛',ne:'PM Fasal Bima Yojana',sub:'Pradhan Mantri Fasal Bima Yojana',d:`<strong>Premium:</strong> рдЦрд░реАрдл/Kharif 2%, рд░рдмреА/Rabi 1.5%<br><br><strong>Coverage:</strong> рдмрд╛рдврд╝, рд╕реВрдЦрд╛, рдЪрдХреНрд░рд╡рд╛рдд / Flood, drought, cyclone<br><br><strong>Helpline:</strong> 1800-200-7710<br><span class="scheme-tag tag-green">Crop Insurance</span><span class="scheme-tag tag-blue">Low Premium</span>`},
  {i:'ЁЯПж',c:'#2980b9',nh:'рдХрд┐рд╕рд╛рди рдХреНрд░реЗрдбрд┐рдЯ рдХрд╛рд░реНрдб',ne:'Kisan Credit Card (KCC)',sub:'Kisan Credit Card (KCC)',d:`<strong>Interest:</strong> 7% (рд╕рдмреНрд╕рд┐рдбреА рдХреЗ рд╕рд╛рде 4% / 4% with subsidy)<br><br><strong>Coverage:</strong> Crops, Dairy & Fisheries<br><br><strong>Apply:</strong> Nearest bank<br><span class="scheme-tag tag-green">4% Interest</span><span class="scheme-tag tag-blue">Flexible</span>`},
  {i:'ЁЯТз',c:'#1abc9c',nh:'PM рдХреГрд╖рд┐ рд╕рд┐рдВрдЪрд╛рдИ рдпреЛрдЬрдирд╛',ne:'PM Krishi Sinchai Yojana',sub:'PMKSY тАФ Har Khet Ko Pani',d:`<strong>Includes:</strong> Drip & Sprinkler systems<br><br><strong>Subsidy:</strong> State-wise рд╕рдмреНрд╕рд┐рдбреА / Varies by state<br><span class="scheme-tag tag-green">Water Security</span><span class="scheme-tag tag-blue">Drip/Sprinkler</span>`},
  {i:'ЁЯМ▒',c:'#8e44ad',nh:'рдореГрджрд╛ рд╕реНрд╡рд╛рд╕реНрдереНрдп рдХрд╛рд░реНрдб',ne:'Soil Health Card Scheme',sub:'Soil Health Card Scheme',d:`<strong>Benefit:</strong> Free soil testing every 2 years<br><br><strong>Report:</strong> Nutrient status + fertilizer recommendation<br><span class="scheme-tag tag-green">Free Testing</span><span class="scheme-tag tag-blue">2 Yearly</span>`},
  {i:'ЁЯМ┐',c:'#27ae60',nh:'рдЬреИрд╡рд┐рдХ рдЦреЗрддреА рдпреЛрдЬрдирд╛',ne:'Organic Farming (PKVY)',sub:'Paramparagat Krishi Vikas Yojana',d:`<strong>Support:</strong> тВ╣50,000/hectare over 3 years<br><br><strong>Includes:</strong> Training, certification, marketing<br><span class="scheme-tag tag-green">тВ╣50,000/ha</span><span class="scheme-tag tag-blue">3 Years</span>`},
  {i:'ЁЯЫТ',c:'#e67e22',nh:'рд░рд╛рд╖реНрдЯреНрд░реАрдп рдХреГрд╖рд┐ рдмрд╛рдЬрд╛рд░',ne:'e-NAM (National Agri Market)',sub:'National Agriculture Market (e-NAM)',d:`<strong>Type:</strong> Online trading platform<br><br><strong>Benefit:</strong> Sell produce nationwide at better prices<br><strong>Portal:</strong> enam.gov.in<br><span class="scheme-tag tag-green">Better Prices</span><span class="scheme-tag tag-blue">Online</span>`},
  {i:'ЁЯС┤',c:'#c0392b',nh:'PM рдХрд┐рд╕рд╛рди рдорд╛рдирдзрди рдпреЛрдЬрдирд╛',ne:'Kisan Pension Scheme',sub:'PM Kisan Mandhan Yojana',d:`<strong>Pension:</strong> тВ╣3,000/month after age 60<br><br><strong>Entry Age:</strong> 18тАУ40 years<br><br><strong>Contribution:</strong> тВ╣55тАУтВ╣200/month<br><span class="scheme-tag tag-green">тВ╣3,000/month</span><span class="scheme-tag tag-blue">Pension</span>`},
  {i:'ЁЯРЯ',c:'#3498db',nh:'PM рдорддреНрд╕реНрдп рд╕рдВрдкрджрд╛ рдпреЛрдЬрдирд╛',ne:'PM Matsya Sampada Yojana',sub:'PMMSY',d:`<strong>Sector:</strong> Fisheries / рдорддреНрд╕реНрдп рдкрд╛рд▓рди<br><br><strong>Subsidy:</strong> 40тАУ60% based on category<br><span class="scheme-tag tag-green">40-60% Subsidy</span><span class="scheme-tag tag-blue">Fisheries</span>`},
  {i:'ЁЯЪЬ',c:'#f39c12',nh:'PM рдХрд┐рд╕рд╛рди рдЯреНрд░реИрдХреНрдЯрд░ рдпреЛрдЬрдирд╛',ne:'PM Kisan Tractor Yojana',sub:'PM Kisan Tractor Yojana',d:`<strong>Benefit:</strong> 20тАУ50% subsidy on tractor purchase<br><br><strong>Apply:</strong> Nearest agriculture department<br><span class="scheme-tag tag-orange">20-50% Subsidy</span>`},
  {i:'ЁЯСйтАНЁЯМ╛',c:'#9b59b6',nh:'рдорд╣рд┐рд▓рд╛ рдХрд┐рд╕рд╛рди рд╕рд╢рдХреНрддрд┐рдХрд░рдг',ne:'Women Farmer Empowerment',sub:'Mahila Kisan Sashaktikaran Pariyojana',d:`<strong>Target:</strong> Women farmers<br><strong>Benefit:</strong> Skill training + financial support<br><span class="scheme-tag tag-green">Women Farmers</span>`},
  {i:'ЁЯПЧя╕П',c:'#1abc9c',nh:'рдХреГрд╖рд┐ рдЕрд╡рд╕рдВрд░рдЪрдирд╛ рдирд┐рдзрд┐',ne:'Agriculture Infrastructure Fund',sub:'Agriculture Infrastructure Fund',d:`<strong>Loan:</strong> Up to тВ╣2 crore<br><br><strong>Interest Subsidy:</strong> 3%<br><br><strong>For:</strong> Warehouses, cold storage, processing units<br><span class="scheme-tag tag-green">тВ╣2 Crore</span><span class="scheme-tag tag-blue">3% Subsidy</span>`},
];

const farmFAQs=[
  {qh:'рдЧреЗрд╣реВрдВ рдореЗрдВ рдкреАрд▓рд╛ рд░рд╕реНрдЯ рд░реЛрдЧ',qe:'Yellow Rust in Wheat',ah:'ЁЯМ╛ рдкреАрд▓рд╛ рд░рд╕реНрдЯ:\nтАв рд▓рдХреНрд╖рдг: рдкрддреНрддрд┐рдпреЛрдВ рдкрд░ рдкреАрд▓реА рдзрд╛рд░рд┐рдпрд╛рдВ\nтАв рдЙрдкрд╛рдп: Propiconazole 25% EC 200ml/рд╣реЗрдХреНрдЯреЗрдпрд░\nтАв рдХрд┐рд╕реНрдо: HD-2967 рдкреНрд░рддрд┐рд░реЛрдзреА рд╣реИ',ae:'ЁЯМ╛ Yellow Rust:\nтАв Symptoms: Yellow stripes on leaves\nтАв Treatment: Propiconazole 25% EC spray\nтАв Use resistant variety HD-2967'},
  {qh:'рдЦрд╛рдж рдХрд╛ рд╕рд╣реА рдЙрдкрдпреЛрдЧ',qe:'Proper Fertilizer Use',ah:'ЁЯТК рдЦрд╛рдж рдкреНрд░рдмрдВрдзрди:\nтАв рдмреБрдЖрдИ рдкрд░: DAP рдлрд╛рд╕реНрдлреЛрд░рд╕ рдХреЗ рд▓рд┐рдП\nтАв 20 рджрд┐рди рдмрд╛рдж: рдпреВрд░рд┐рдпрд╛ рдирд╛рдЗрдЯреНрд░реЛрдЬрди рдХреЗ рд▓рд┐рдП\nтАв 40 рджрд┐рди рдмрд╛рдж: рджреВрд╕рд░реА рдпреВрд░рд┐рдпрд╛ рдХрд┐рд╕реНрдд\nтАв рдорд┐рдЯреНрдЯреА рдЬрд╛рдВрдЪ рдкрд╣рд▓реЗ рдХрд░рд╡рд╛рдПрдВ',ae:'ЁЯТК Fertilizer Management:\nтАв At sowing: DAP for phosphorus\nтАв 20 days: Urea for nitrogen\nтАв 40 days: Second urea dose\nтАв Always soil test first'},
  {qh:'рдЯрдкрдХ рд╕рд┐рдВрдЪрд╛рдИ',qe:'Drip Irrigation',ah:'ЁЯТз рдЯрдкрдХ рд╕рд┐рдВрдЪрд╛рдИ:\nтАв 40-50% рдкрд╛рдиреА рдХреА рдмрдЪрдд\nтАв рдХрдо рдЦрд░рдкрддрд╡рд╛рд░\nтАв PMKSY рдХреЗ рддрд╣рдд рд╕рдмреНрд╕рд┐рдбреА',ae:'ЁЯТз Drip Irrigation:\nтАв Saves 40-50% water\nтАв Reduces weeds\nтАв Subsidy under PMKSY scheme'},
  {qh:'рдЬреИрд╡рд┐рдХ рдЦрд╛рдж рдмрдирд╛рдирд╛',qe:'Making Organic Compost',ah:'ЁЯМ┐ рдЬреИрд╡рд┐рдХ рдЦрд╛рдж:\nтАв рдЦреЗрдд рдХрдЪрд░рд╛ + рдЧреЛрдмрд░ = рдХрдореНрдкреЛрд╕реНрдЯ\nтАв 3-4 рдорд╣реАрдиреЗ рдореЗрдВ рддреИрдпрд╛рд░\nтАв 5-10 рдЯрди/рд╣реЗрдХреНрдЯреЗрдпрд░ рдбрд╛рд▓реЗрдВ',ae:'ЁЯМ┐ Organic Compost:\nтАв Farm waste + Cow dung = Compost\nтАв Ready in 3-4 months\nтАв Apply 5-10 tonnes/hectare'},
  {qh:'рдлрд╕рд▓ рдЪрдХреНрд░',qe:'Crop Rotation',ah:'ЁЯФД рдлрд╕рд▓ рдЪрдХреНрд░:\nтАв рдЧреЗрд╣реВрдВ-рдзрд╛рди рдХреЗ рдмрд╛рдж рджрд▓рд╣рди\nтАв рдирд╛рдЗрдЯреНрд░реЛрдЬрди рд╕реНрдерд┐рд░реАрдХрд░рдг рд╣реЛрддрд╛ рд╣реИ\nтАв рдорд┐рдЯреНрдЯреА рд╕реНрд╡рд╛рд╕реНрдереНрдп рдмреЗрд╣рддрд░ рд╣реЛрддрд╛ рд╣реИ',ae:'ЁЯФД Crop Rotation:\nтАв After wheat-paddy, grow pulses\nтАв Nitrogen fixation improves\nтАв Better soil health'},
];

const animalFAQs=[
  {qh:'рджреВрдз рдЙрддреНрдкрд╛рджрди рдХреИрд╕реЗ рдмрдврд╝рд╛рдПрдВ',qe:'How to Increase Milk Production',ah:'ЁЯРД рджреВрдз рдЙрддреНрдкрд╛рджрди:\nтАв рд╕рдВрддреБрд▓рд┐рдд рдЪрд╛рд░рд╛: рд╣рд░рд╛+рд╕реВрдЦрд╛+рджрд╛рдирд╛\nтАв рд╕реНрд╡рдЪреНрдЫ рдкрд╛рдиреА 3-4 рдмрд╛рд░/рджрд┐рди\nтАв рд╕рдордп рдкрд░ рджреВрдз рджреБрд╣реЗрдВ\nтАв рдЯреАрдХрд╛рдХрд░рдг рдЬрд░реВрд░реА',ae:'ЁЯРД Milk Production:\nтАв Balanced feed: green+dry+grain\nтАв Clean water 3-4 times/day\nтАв Regular milking intervals\nтАв Timely vaccination'},
  {qh:'рдмрдХрд░реА рдкрд╛рд▓рди',qe:'Goat Farming',ah:'ЁЯРР рдмрдХрд░реА рдкрд╛рд▓рди:\nтАв рдХрдо рд▓рд╛рдЧрдд, рдЬрд▓реНрджреА рдЖрдп\nтАв National Livestock Mission: рд╕рдмреНрд╕рд┐рдбреА\nтАв Barbari, Jamuna Pari рдЙрддреНрддрдо рдХрд┐рд╕реНрдореЗрдВ',ae:'ЁЯРР Goat Farming:\nтАв Low cost, quick income\nтАв NLM subsidy available\nтАв Best breeds: Barbari, Jamuna Pari'},
  {qh:'рдореБрд░реНрдЧреА рдкрд╛рд▓рди',qe:'Poultry Farming',ah:'ЁЯРФ рдореБрд░реНрдЧреА рдкрд╛рд▓рди:\nтАв NLM рд╕реЗ рд╢реЗрдб рдирд┐рд░реНрдорд╛рдг рд╕рд╣рд╛рдпрддрд╛\nтАв KCC рд╕реЗ рдЛрдг рд▓реЗрдВ\nтАв рдХрдо рдирд┐рд╡реЗрд╢ рдореЗрдВ рдЕрдЪреНрдЫреА рдЖрдп',ae:'ЁЯРФ Poultry Farming:\nтАв NLM support for shed construction\nтАв KCC loan available\nтАв Good income with small investment'},
];

const KB={
  'рдЧреЗрд╣реВрдВ':{hi:'ЁЯМ╛ рдЧреЗрд╣реВрдВ рдХреА рдмреБрдЖрдИ:\nтАв рд╕рдордп: рдЕрдХреНрдЯреВрдмрд░-рдирд╡рдВрдмрд░\nтАв рджреВрд░реА: 20-22 cm\nтАв рдмреАрдЬ: 100-125 kg/рд╣реЗрдХреНрдЯреЗрдпрд░\nтАв рдЦрд╛рдж: DAP 50kg + рдпреВрд░рд┐рдпрд╛ 130kg\nтАв рдХрд┐рд╕реНрдореЗрдВ: HD-2967, PBW-343, K-307'},
  'wheat':{en:'ЁЯМ╛ Wheat Sowing:\nтАв Time: October-November\nтАв Spacing: 20-22 cm\nтАв Seed: 100-125 kg/ha\nтАв Fertilizer: DAP 50kg + Urea 130kg\nтАв Varieties: HD-2967, PBW-343, K-307'},
  'рдзрд╛рди':{hi:'ЁЯМ╛ рдзрд╛рди:\nтАв рдирд░реНрд╕рд░реА: рдЬреВрди тАв рд░реЛрдкрд╛рдИ: рдЬреБрд▓рд╛рдИ\nтАв рдмреАрдЬ: 20-25 kg/рд╣реЗрдХреНрдЯреЗрдпрд░\nтАв рдкрд╛рдиреА: 5cm рдЦрдбрд╝рд╛ рд░рдЦреЗрдВ\nтАв рдХрд┐рд╕реНрдореЗрдВ: рдкреВрд╕рд╛ рдмрд╛рд╕рдорддреА-1121'},
  'paddy':{en:'ЁЯМ╛ Paddy:\nтАв Nursery: June тАв Transplant: July\nтАв Seed: 20-25 kg/ha\nтАв Water: 5cm standing\nтАв Variety: Pusa Basmati-1121'},
  'pm-kisan':{hi:'ЁЯТ░ PM-KISAN: тВ╣6,000/рд╡рд░реНрд╖, 3 рдХрд┐рд╕реНрддреЛрдВ рдореЗрдВ\nрдЖрд╡реЗрджрди: pmkisan.gov.in\nHelpline: 155261',en:'ЁЯТ░ PM-KISAN: тВ╣6,000/year in 3 installments\nApply: pmkisan.gov.in\nHelpline: 155261'},
  'kisan':{hi:'ЁЯТ░ PM-KISAN: тВ╣6,000/рд╡рд░реНрд╖ред pmkisan.gov.in',en:'ЁЯТ░ PM-KISAN: тВ╣6,000/year. pmkisan.gov.in'},
  'рд╕рд░рд╕реЛрдВ':{hi:'ЁЯМ╗ рд╕рд░рд╕реЛрдВ:\nтАв рдмреБрдЖрдИ: рдЕрдХреНрдЯреВрдмрд░ тАв рдХрдЯрд╛рдИ: рдлрд░рд╡рд░реА\nтАв рдмреАрдЬ: 5-6 kg/рд╣реЗрдХреНрдЯреЗрдпрд░\nтАв рдЙрдкрдЬ: 15-20 рдХреНрд╡рд┐рдВрдЯрд▓/рд╣реЗрдХреНрдЯреЗрдпрд░'},
  'mustard':{en:'ЁЯМ╗ Mustard:\nтАв Sowing: October тАв Harvest: February\nтАв Seed: 5-6 kg/ha\nтАв Yield: 15-20 quintals/ha'},
  'kcc':{hi:'ЁЯТ│ KCC: рдмреНрдпрд╛рдЬ 4-7%\nрдбреЗрдпрд░реА рдФрд░ рдорддреНрд╕реНрдп рдкрд╛рд▓рди рднреА\nрдирдЬрджреАрдХреА рдмреИрдВрдХ рдореЗрдВ рдЖрд╡реЗрджрди',en:'ЁЯТ│ KCC: Interest 4-7%\nCovers dairy & fisheries\nApply at nearest bank'},
  'insurance':{en:'ЁЯМ╛ PMFBY: Kharif 2%, Rabi 1.5% premium\nCoverage: Flood, drought, pests\nHelpline: 1800-200-7710',hi:'ЁЯМ╛ PMFBY: рдЦрд░реАрдл 2%, рд░рдмреА 1.5% рдкреНрд░реАрдорд┐рдпрдо\nHelpline: 1800-200-7710'},
  'fasal bima':{hi:'ЁЯМ╛ рдлрд╕рд▓ рдмреАрдорд╛:\nтАв рдЦрд░реАрдл рдкреНрд░реАрдорд┐рдпрдо: 2%\nтАв рд░рдмреА рдкреНрд░реАрдорд┐рдпрдо: 1.5%\nтАв рдХрд╡рд░реЗрдЬ: рдмрд╛рдврд╝, рд╕реВрдЦрд╛, рдХреАрдЯ\nтАв Helpline: 1800-200-7710'},
  'рдкрд╢реБ':{hi:'ЁЯРД рдкрд╢реБрдкрд╛рд▓рди:\nтАв рд╕рдВрддреБрд▓рд┐рдд рдЪрд╛рд░рд╛ рджреЗрдВ\nтАв рд╕рдордп рдкрд░ рдЯреАрдХрд╛ рд▓рдЧрд╡рд╛рдПрдВ\nтАв KCC рд╕реЗ рдЛрдг рдЙрдкрд▓рдмреНрдз'},
  'animal':{en:'ЁЯРД Animal Husbandry:\nтАв Balanced feed is key\nтАв Timely vaccination essential\nтАв KCC loan available'},
  'рдореМрд╕рдо':{hi:'ЁЯМдя╕П рдореМрд╕рдо рдЯреИрдм рдкрд░ рдЬрд╛рдПрдВред\nFeb: рдЧреЗрд╣реВрдВ рдХреЗ рд▓рд┐рдП рдЕрдЪреНрдЫрд╛\nрд╕рд┐рдВрдЪрд╛рдИ: 15-20 рджрд┐рди рдкрд░'},
  'weather':{en:'ЁЯМдя╕П Check the Weather tab for live data.\nFeb: Good for wheat grain filling\nIrrigate every 15-20 days'},
};

window.onload=()=>{renderCal();renderSchemes();renderFAQs();renderCropTable()};

function showTab(n,el){
  document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('tab-'+n).classList.add('active');
  el.classList.add('active');
}

function applyTranslations(){
  const t=T[lang];
  for(const[k,v]of Object.entries(t)){
    if(['aiModeLabel','aiToggleLabel','aiModeOff','aiToggleOff'].includes(k))continue;
    const el=document.getElementById(k);
    if(el)el.textContent=v;
  }
  document.querySelectorAll('.tlbl').forEach(el=>{
    el.textContent=el.getAttribute('data-'+lang);
  });
  document.getElementById('langBtn').textContent=lang==='hi'?'рд╣рд┐рдВ/EN':'EN/рд╣рд┐рдВ';
  document.getElementById('chatInput').placeholder=lang==='hi'
    ?'рдЕрдкрдирд╛ рд╕рд╡рд╛рд▓ рдкреВрдЫреЗрдВ... / Ask your question...'
    :'Ask your question... / рдЕрдкрдирд╛ рд╕рд╡рд╛рд▓ рдкреВрдЫреЗрдВ...';
  updateAIMode();
}

function toggleLang(){
  lang=lang==='hi'?'en':'hi';
  applyTranslations();
  renderCal();renderSchemes();renderFAQs();renderCropTable();
  toast(lang==='hi'?'тЬЕ рд╣рд┐рдВрджреА рдЪрд╛рд▓реВ':'тЬЕ English On');
}

function toggleTheme(){
  isDark=!isDark;
  document.documentElement.setAttribute('data-theme',isDark?'dark':'light');
  document.getElementById('themeBtn').textContent=isDark?'тШАя╕П':'ЁЯМЩ';
  toast(isDark?'Dark mode ЁЯМЩ':'Light mode тШАя╕П');
}

function updateAIMode(){
  isAI=document.getElementById('aiToggle').checked;
  const t=T[lang];
  document.getElementById('aiModeLabel').textContent=isAI?t.aiModeLabel:t.aiModeOff;
  document.getElementById('aiToggleLabel').textContent=isAI?t.aiToggleLabel:t.aiToggleOff;
}

// CALENDAR
function renderCal(){
  const g=document.getElementById('calGrid');
  document.getElementById('calM1').textContent=(lang==='hi'?hiM:enM)[calM]+' '+calY;
  document.getElementById('calM2').textContent=(lang==='hi'?enM:hiM)[calM]+' '+calY;
  const days=lang==='hi'?hiD:enD;
  let h=days.map(d=>`<div class="cal-day-header">${d}</div>`).join('');
  const first=new Date(calY,calM,1).getDay(),total=new Date(calY,calM+1,0).getDate(),today=new Date();
  for(let i=0;i<first;i++)h+='<div class="cal-day empty"></div>';
  for(let d=1;d<=total;d++){
    const iT=d===today.getDate()&&calM===today.getMonth()&&calY===today.getFullYear();
    const dots=(evts[calM]||[]).map(c=>`<div class="cal-event-dot" style="background:${c}"></div>`).join('');
    h+=`<div class="cal-day${iT?' today':''}"><span class="day-num">${d}</span>${dots}</div>`;
  }
  g.innerHTML=h;
}
function changeMonth(d){calM+=d;if(calM<0){calM=11;calY--;}if(calM>11){calM=0;calY++;}renderCal();}

function renderCropTable(){
  document.getElementById('cropTbody').innerHTML=cropRows.map(r=>`
    <tr><td>${lang==='hi'?r.mh:r.me}<br><small>${lang==='hi'?r.me:r.mh}</small></td>
    <td><span class="season-badge season-${r.s}">${lang==='hi'?r.sh:r.se}</span></td>
    <td>${lang==='hi'?r.ah:r.ae}</td><td>${r.c}</td></tr>`).join('');
}

function renderSchemes(){
  document.getElementById('schemesContainer').innerHTML=schemes.map((s,i)=>`
    <div class="scheme-card" id="sc${i}" onclick="toggleSc(${i})">
      <div class="scheme-header">
        <div class="scheme-icon" style="background:${s.c}22;color:${s.c}">${s.i}</div>
        <div class="scheme-title"><h3>${lang==='hi'?s.nh:s.ne}</h3><p>${s.sub}</p></div>
        <span class="scheme-chevron">тЦ╢</span>
      </div>
      <div class="scheme-body"><div class="scheme-detail">${s.d}</div></div>
    </div>`).join('');
}
function toggleSc(i){document.getElementById('sc'+i).classList.toggle('open');}

function renderFAQs(){
  document.getElementById('farmingFAQ').innerHTML=farmFAQs.map((f,i)=>faqH(f,'f'+i)).join('');
  document.getElementById('animalFAQ').innerHTML=animalFAQs.map((f,i)=>faqH(f,'a'+i)).join('');
}
function faqH(f,id){
  const q=lang==='hi'?(f.qh||f.q):(f.qe||f.q);
  const a=lang==='hi'?(f.ah||f.a):(f.ae||f.a);
  return `<div class="faq-item" id="fq${id}"><div class="faq-q" onclick="toggleFAQ('${id}')">${q}<span class="faq-chevron">тЦ╝</span></div><div class="faq-a" style="white-space:pre-line">${a}</div></div>`;
}
function toggleFAQ(id){document.getElementById('fq'+id).classList.toggle('open');}

// CHAT
function handleKey(e){if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage();}}
function sendChip(el){document.getElementById('chatInput').value=el.textContent.trim();sendMessage();}
function getTime(){return new Date().toLocaleTimeString('hi-IN',{hour:'2-digit',minute:'2-digit'});}

async function sendMessage(){
  if(sending)return;
  const inp=document.getElementById('chatInput'),text=inp.value.trim();
  if(!text)return;
  inp.value='';
  addMsg('user',text);
  sending=true;
  document.getElementById('sendBtn').disabled=true;
  dataBytes+=text.length*2;
  document.getElementById('dataCounter').textContent=(dataBytes/1024).toFixed(1)+'KB';

  const ck=text.toLowerCase()+'_'+lang;
  if(cache[ck]){
    cacheHits++;document.getElementById('cacheHits').textContent=cacheHits;
    setTimeout(()=>{addMsg('bot','ЁЯУж [Cached] '+cache[ck],'cache');sending=false;document.getElementById('sendBtn').disabled=false;},200);
    return;
  }

  const tid='t'+Date.now();addTyping(tid);
  let reply,src='offline';
  try{
    if(isAI){
      try{reply=await callAI(text);src='claude';}
      catch(e){console.warn('AI failed:',e);reply=offlineReply(text);src='fallback';}
    } else {reply=offlineReply(text);src='offline';}
  }catch(e){reply=lang==='hi'?'тЪая╕П рдХреБрдЫ рдЧрд▓рдд рд╣реБрдЖред рджреЛрдмрд╛рд░рд╛ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВред':'тЪая╕П Something went wrong. Try again.';src='error';}

  document.getElementById(tid)?.remove();
  cache[ck]=reply;
  addMsg('bot',reply,src);
  sending=false;document.getElementById('sendBtn').disabled=false;
}

async function callAI(text){
  aiCalls++;document.getElementById('aiCalls').textContent=aiCalls;
  const sys=lang==='hi'
    ?`рдЖрдк "рдЧреНрд░рд╛рдо рд╕рд╣рд╛рдпрдХ AI" рд╣реИрдВ тАФ рднрд╛рд░рддреАрдп рдХрд┐рд╕рд╛рдиреЛрдВ рдХреЗ AI рд╕рд╣рд╛рдпрдХред рд╣рдореЗрд╢рд╛ рд╣рд┐рдВрджреА рдореЗрдВ рдЬрд╡рд╛рдм рджреЗрдВред
рд╡рд┐рд╖рдп: рдЦреЗрддреА, рдлрд╕рд▓реЗрдВ, рд╕рд░рдХрд╛рд░реА рдпреЛрдЬрдирд╛рдПрдВ, рдкрд╢реБрдкрд╛рд▓рди, рдореМрд╕рдо, рдорд┐рдЯреНрдЯреА, рдХреАрдЯред
рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдФрд░ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдЬрд╡рд╛рдм рджреЗрдВред Emoji рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред рдорд╛рддреНрд░рд╛/рд╕рдордп/рдХрд┐рд╕реНрдореЗрдВ рдЬрд░реВрд░ рдмрддрд╛рдПрдВред
рдЦреЗрддреА рд╕реЗ рдЕрд▓рдЧ рд╕рд╡рд╛рд▓ рдкрд░ рд╡рд┐рдирдореНрд░рддрд╛ рд╕реЗ рдХрд╣реЗрдВ: "рдореИрдВ рдХреЗрд╡рд▓ рдХреГрд╖рд┐ рд╡рд┐рд╖рдпреЛрдВ рдкрд░ рд╕рд╣рд╛рдпрддрд╛ рдХрд░рддрд╛ рд╣реВрдБред"`
    :`You are "Gram Sahayak AI" тАФ AI assistant for Indian farmers. Always reply in English.
Topics: farming, crops, govt schemes, animal husbandry, weather, soil, pests.
Give concise practical answers. Use emojis. Include quantities, timings, varieties.
If question is unrelated to agriculture, say: "I assist only with agricultural topics."`;

  history.push({role:'user',content:text});
  if(history.length>12)history.splice(0,2);

  const res=await fetch('https://api.anthropic.com/v1/messages',{
    method:'POST',
    headers:{'Content-Type':'application/json','x-api-key':'sk-b831fb2895974c1d98ca4381f81c10f3','anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},
    body:JSON.stringify({model:'claude-haiku-4-5-20251001',max_tokens:600,system:sys,messages:history.slice(-8)})
  });
  if(!res.ok){const e=await res.json();throw new Error(e.error?.message||'API error '+res.status);}
  const d=await res.json();
  const reply=d.content?.[0]?.text||'';
  history.push({role:'assistant',content:reply});
  dataBytes+=reply.length;
  document.getElementById('dataCounter').textContent=(dataBytes/1024).toFixed(1)+'KB';
  return reply;
}

function offlineReply(text){
  const lo=text.toLowerCase();
  for(const[k,v]of Object.entries(KB)){
    if(lo.includes(k.toLowerCase())){
      return v[lang]||v.hi||v.en||Object.values(v)[0];
    }
  }
  if(/рдирдорд╕реНрддреЗ|hello|hi\b|рдирдорд╕реНрдХрд╛рд░/.test(lo)){
    return lang==='hi'?'ЁЯЩП рдирдорд╕реНрддреЗ! рдлрд╕рд▓, рдореМрд╕рдо, рдпрд╛ рд╕рд░рдХрд╛рд░реА рдпреЛрдЬрдирд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкреВрдЫреЗрдВред':'ЁЯЩП Hello! Ask me about crops, weather, or government schemes!';
  }
  if(/рдЦрд╛рдж|fertilizer/.test(lo)){
    return lang==='hi'?'ЁЯТК DAP рдмреБрдЖрдИ рдкрд░, рдпреВрд░рд┐рдпрд╛ 20-40 рджрд┐рди рдмрд╛рджред рдорд┐рдЯреНрдЯреА рдЬрд╛рдВрдЪ рдкрд╣рд▓реЗ рдХрд░рд╡рд╛рдПрдВред':'ЁЯТК DAP at sowing, Urea 20-40 days later. Always soil test first.';
  }
  if(/рдкрд╛рдиреА|water|рд╕рд┐рдВрдЪрд╛рдИ|irrigation/.test(lo)){
    return lang==='hi'?'ЁЯТз рдЧреЗрд╣реВрдВ: 5-6 рд╕рд┐рдВрдЪрд╛рдИред PMKSY рд╕реЗ рдбреНрд░рд┐рдк рд╕рдмреНрд╕рд┐рдбреАред 40% рдкрд╛рдиреА рдмрдЪрд╛рдПрдВред':'ЁЯТз Wheat: 5-6 irrigations. PMKSY drip subsidy saves 40% water.';
  }
  if(/рд╕рд░рдХрд╛рд░|government|scheme|рдпреЛрдЬрдирд╛/.test(lo)){
    return lang==='hi'?'ЁЯПЫя╕П PM-KISAN: тВ╣6,000/рд╡рд░реНрд╖ | PMFBY: рдлрд╕рд▓ рдмреАрдорд╛ | KCC: 4% рдЛрдг\nрдпреЛрдЬрдирд╛рдПрдВ рдЯреИрдм рджреЗрдЦреЗрдВред':'ЁЯПЫя╕П PM-KISAN: тВ╣6,000/year | PMFBY: crop insurance | KCC: 4% loan\nCheck Schemes tab.';
  }
  return lang==='hi'
    ?`ЁЯдФ "${text}" рдХреЗ рд▓рд┐рдП рдСрдлрд▓рд╛рдЗрди рдЬрд╛рдирдХрд╛рд░реА рдирд╣реАрдВред\nAI Mode рдЪрд╛рд▓реВ рдХрд░реЗрдВ рдпрд╛ рдкреВрдЫреЗрдВ:\nЁЯМ╛ рдЧреЗрд╣реВрдВ, рдзрд╛рди, рд╕рд░рд╕реЛрдВ\nЁЯПЫя╕П PM-KISAN, KCC, рдмреАрдорд╛`
    :`ЁЯдФ No offline info for "${text}".\nEnable AI Mode or ask:\nЁЯМ╛ Wheat, paddy, mustard\nЁЯПЫя╕П PM-KISAN, KCC, insurance`;
}

function addMsg(type,text,src){
  const msgs=document.getElementById('chatMessages');
  const div=document.createElement('div');
  div.className='msg '+type;
  let srcHtml='';
  if(src==='claude')srcHtml='<div class="msg-source">ЁЯдЦ Claude AI</div>';
  else if(src==='cache')srcHtml='<div class="msg-source">ЁЯУж Cached</div>';
  else if(src==='fallback')srcHtml='<div class="msg-source">ЁЯУ╡ Offline Fallback</div>';
  else if(src==='offline')srcHtml='<div class="msg-source">ЁЯУ╡ Offline</div>';
  div.innerHTML=`<div class="msg-avatar">${type==='bot'?'ЁЯМ╛':'ЁЯСд'}</div><div><div class="msg-bubble" style="white-space:pre-line">${text}</div><div class="msg-time">${getTime()}</div>${type==='bot'?srcHtml:''}</div>`;
  msgs.appendChild(div);
  msgs.scrollTop=msgs.scrollHeight;
  const chips=document.getElementById('quickChips');
  if(chips&&type==='user')chips.remove();
}

function addTyping(id){
  const msgs=document.getElementById('chatMessages');
  const div=document.createElement('div');
  div.className='msg bot';div.id=id;
  div.innerHTML=`<div class="msg-avatar">ЁЯМ╛</div><div class="msg-bubble"><div class="typing-dots"><span></span><span></span><span></span></div></div>`;
  msgs.appendChild(div);msgs.scrollTop=msgs.scrollHeight;
}

// WEATHER
const wAdvice=[
  {i:'ЁЯМ╛',t:{hi:'рдЖрдЬ рдЧреЗрд╣реВрдВ рдХреА рд╕рд┐рдВрдЪрд╛рдИ рдХреЗ рд▓рд┐рдП рдЙрддреНрддрдо рд╕рдордп',en:'Good time to irrigate wheat fields'}},
  {i:'ЁЯМ╗',t:{hi:'рд╕рд░рд╕реЛрдВ рдХреА рдХрдЯрд╛рдИ рдХреЗ рд▓рд┐рдП рдореМрд╕рдо рдЕрдиреБрдХреВрд▓',en:'Weather suitable for mustard harvesting'}},
  {i:'ЁЯТК',t:{hi:'рдХреАрдЯрдирд╛рд╢рдХ рдЫрд┐рдбрд╝рдХрд╛рд╡ рд╕реЗ рдкрд╣рд▓реЗ рд╣рд╡рд╛ рдЬрд╛рдВрдЪреЗрдВ',en:'Check wind before pesticide spraying'}},
  {i:'ЁЯРД',t:{hi:'рдкрд╢реБрдУрдВ рдХреЛ рдкрд░реНрдпрд╛рдкреНрдд рдкрд╛рдиреА рдкрд┐рд▓рд╛рдПрдВ',en:'Ensure animals have adequate water'}},
];

function fetchWeather(){
  document.getElementById('wBtnTxt').textContent=lang==='hi'?'ЁЯУб рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ...':'ЁЯУб Loading...';
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(
      p=>fetch(`https://api.open-meteo.com/v1/forecast?latitude=${p.coords.latitude}&longitude=${p.coords.longitude}&current_weather=true&hourly=relativehumidity_2m,uv_index`)
        .then(r=>r.json()).then(d=>showWeather(d,p.coords.latitude,p.coords.longitude)).catch(()=>mockWeather()),
      ()=>mockWeather()
    );
  } else mockWeather();
}

function showWeather(d,lat,lon){
  const cw=d.current_weather,temp=Math.round(cw.temperature),wind=Math.round(cw.windspeed),code=cw.weathercode;
  let dh='рдЖрдВрд╢рд┐рдХ рдмрд╛рджрд▓',de='Partly Cloudy',icon='тЫЕ';
  if(code<=1){dh='рд╕рд╛рдл рдЖрд╕рдорд╛рди';de='Clear Sky';icon='тШАя╕П';}
  else if(code<=3){dh='рдмрд╛рджрд▓';de='Cloudy';icon='тШБя╕П';}
  else if(code<=67){dh='рдмрд╛рд░рд┐рд╢';de='Rain';icon='ЁЯМзя╕П';}
  else if(code>=95){dh='рдЧрд░рдЬ';de='Thunderstorm';icon='тЫИя╕П';}
  const hum=d.hourly?.relativehumidity_2m?.[new Date().getHours()]||65;
  const uv=d.hourly?.uv_index?.[new Date().getHours()]||4;
  document.getElementById('wTemp').textContent=temp+'┬░C';
  document.getElementById('wDesc').textContent=lang==='hi'?dh:de;
  document.getElementById('wIcon').textContent=icon;
  document.getElementById('wHum').textContent=hum+'%';
  document.getElementById('wWnd').textContent=wind+' km/h';
  document.getElementById('wUV').textContent=uv;
  document.getElementById('wLoc').textContent=`${lat.toFixed(2)}┬░N, ${lon.toFixed(2)}┬░E`;
  document.getElementById('wHumLbl').textContent=T[lang].wHumLbl;
  document.getElementById('wWndLbl').textContent=T[lang].wWndLbl;
  buildAdvice(temp,code);
  document.getElementById('weatherDisplay').style.display='block';
  document.getElementById('wBtnTxt').textContent=lang==='hi'?'ЁЯФД рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ':'ЁЯФД Refresh';
}

function mockWeather(){
  document.getElementById('wTemp').textContent='26┬░C';
  document.getElementById('wDesc').textContent=lang==='hi'?'рдЖрдВрд╢рд┐рдХ рдмрд╛рджрд▓':'Partly Cloudy';
  document.getElementById('wIcon').textContent='тЫЕ';
  document.getElementById('wHum').textContent='62%';
  document.getElementById('wWnd').textContent='10 km/h';
  document.getElementById('wUV').textContent='5';
  document.getElementById('wLoc').textContent='Lucknow, Uttar Pradesh';
  document.getElementById('wHumLbl').textContent=T[lang].wHumLbl;
  document.getElementById('wWndLbl').textContent=T[lang].wWndLbl;
  buildAdvice(26,2);
  document.getElementById('weatherDisplay').style.display='block';
  document.getElementById('wBtnTxt').textContent=lang==='hi'?'ЁЯФД рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ':'ЁЯФД Refresh';
}

function buildAdvice(temp,code){
  let arr=[...wAdvice];
  if(temp>32)arr.unshift({i:'ЁЯМбя╕П',t:{hi:'рддрд╛рдкрдорд╛рди рдЕрдзрд┐рдХ тАФ рджреЛрдкрд╣рд░ рдореЗрдВ рдХрд╛рдо рди рдХрд░реЗрдВ, рд╕рд┐рдВрдЪрд╛рдИ рдмрдврд╝рд╛рдПрдВ',en:'High temp тАФ avoid afternoon work, increase irrigation'}});
  if(code>=60)arr.unshift({i:'ЁЯМзя╕П',t:{hi:'рдмрд╛рд░рд┐рд╢ тАФ рдХреАрдЯрдирд╛рд╢рдХ рдЫрд┐рдбрд╝рдХрд╛рд╡ рдмрдВрдж рд░рдЦреЗрдВ',en:'Raining тАФ stop pesticide spraying'}});
  document.getElementById('farmingAdvice').innerHTML=arr.slice(0,4).map(a=>`<div class="advice-item">${a.i} ${a.t[lang]||a.t.hi}</div>`).join('');
}

function toast(msg){
  const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2200);
}
</script>
</body>
</html>
